<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Japan Trek 2025 | TransPerfect</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Swiper / Leaflet / Chart.js / Confetti (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/swiper@10/swiper-bundle.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/swiper@10/swiper-bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root{
      --bg:#0e1a2b;
      --ink:#ffffff;
      --ink-dim:#cfe0ff;
      --muted:#a5b4d4;
      --beige:#e8dcc7;
      --accent:#d30000;           /* red accent used in chart line etc */
      --orange:#f37021;           /* brand orange for buttons & chips */
      --surface:#12213a;
      --surface-2:#172742;
      --card:#15284a;
      --shadow:0 12px 28px rgba(0,0,0,.15);
      --h2:clamp(1.6rem,3.6vw,2.2rem); /* unified section headings */
      --scroll-offset:56px;            /* set live from JS = nav height */
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{font-family:Inter,sans-serif;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block;height:auto}
    .sr-only{position:absolute !important;width:1px;height:1px;margin:-1px;overflow:hidden;clip:rect(0,0,0,0)}

    /* All anchor targets land below the fixed nav */
    [id]{scroll-margin-top:var(--scroll-offset)}

    /* Focus styles */
    :focus-visible{outline:3px solid rgba(243,111,33,.85);outline-offset:2px;border-radius:6px}

    /* Skip link */
    #skip{position:absolute;top:-40px;left:0;background:var(--accent);padding:.5rem 1rem;font-weight:700;z-index:200}
    #skip:focus{top:0}

    /* Progress bar */
    #progress{position:fixed;top:0;left:0;height:3px;background:linear-gradient(90deg,var(--orange),#ffd9c2,var(--orange));transform-origin:0 0;z-index:120}

    /* ========================== NAV (ultra-compact) ========================== */
    nav{
      position:fixed;top:0;left:0;width:100%;
      padding:.2rem .75rem;                 /* very small vertical padding */
      background:rgba(0,0,0,.75);backdrop-filter:blur(8px) saturate(120%);
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;align-items:center;gap:.75rem;z-index:110;
      transition:padding .18s ease, background .18s ease;
    }
    nav .brand{display:flex;align-items:center;gap:.5rem}
    nav .brand img{height:1.1rem;width:auto;display:block}  /* logo never grows nav */
    nav .links{
      flex:1;display:flex;justify-content:center;align-items:center;
      gap:clamp(.6rem,2.4vw,1rem);font-size:.88rem;letter-spacing:.12em;
      text-transform:uppercase;
    }
    nav .links a{font-weight:700;opacity:.92;line-height:1;display:inline-flex;align-items:center;padding:.4rem .2rem;border-radius:.25rem}
    nav .links a:hover{opacity:1}
    nav .links a.is-active{position:relative}
    nav .links a.is-active::after{
      content:"";position:absolute;left:10%;right:10%;bottom:-6px;height:2px;background:var(--orange);border-radius:2px
    }

    /* Header buttons in nav */
    .btn-nav{
      padding:.5rem .85rem;border-radius:.5rem;border:1px solid rgba(255,255,255,.15);
      background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
      transform:translateZ(0); transition:transform .12s ease, box-shadow .12s ease;
    }
    .btn-nav:hover{transform:translateY(-1px)}
    .btn-nav.primary{background:var(--orange);color:#1b120a;border-color:transparent}
    .btn-nav.primary:hover{filter:brightness(.95)}
    .btn-nav.secondary:hover{background:rgba(255,255,255,.12)}

    /* Countdown — minimal, bold, same line-height as links */
    #countBox{display:flex;align-items:center;gap:.25rem;font-variant-numeric:tabular-nums}
    #countBox .num{font-weight:800;font-size:clamp(.95rem,2.2vw,1.1rem);line-height:1}
    #countBox .sep{opacity:.6;margin:0 .1rem}

    /* Compact-on-scroll (even thinner) */
    nav.compact{padding:.15rem .6rem}
    nav.compact .brand img{height:1rem}
    nav.compact .links{gap:.6rem;font-size:.82rem}
    nav.compact #countBox .num{font-size:clamp(.9rem,2vw,1rem)}

    /* ============================ HERO ============================ */
    header{
      position:relative;overflow:hidden;
      margin-top:var(--scroll-offset);
      height:calc(100svh - var(--scroll-offset));
      perspective: 1000px;
    }
    .swiper{width:100%;height:100%}
    .swiper-slide img{width:100%;height:100%;object-fit:cover;transform: translateZ(0)}
    .heroBtn{position:absolute;top:50%;transform:translateY(-50%);width:48px;height:48px;border-radius:50%;background:rgba(255,255,255,.85);display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--shadow);z-index:10}
    .heroBtn svg{width:22px;height:22px;stroke:#000;stroke-width:2;fill:none}
    #prev{left:1rem} #next{right:1rem}
    .heroOverlay{
      position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.28),rgba(0,0,0,.5));
      display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;z-index:5;padding:0 1rem;
      will-change: transform, opacity;
    }
    .heroOverlay h1{font-size:clamp(2rem,5vw,3rem);letter-spacing:.08em;margin-bottom:.6rem}
    .heroOverlay p{max-width:640px;margin-bottom:1.1rem}
    .btn{display:inline-block;padding:.9rem 2rem;background:var(--ink);color:var(--bg);font-weight:700;border-radius:6px}
    .btn:hover{opacity:.88}
    .caption{position:absolute;bottom:0;left:0;width:100%;padding:.75rem 1rem;font-size:.85rem;background:linear-gradient(0deg,rgba(0,0,0,.7),transparent);opacity:0;color:#fff;transition:.3s}
    .swiper-slide:hover .caption{opacity:1}

    .spacer{height:32px}

    /* ============================ CARDS & SECTIONS ============================ */
    .card,.news,.mission,.eventWrap,.afterpartyWrap,.donateWrap,.staffWrap{position:relative}
    .card{max-width:1100px;margin:2rem auto;background:var(--surface);border-radius:1.2rem;box-shadow:var(--shadow);padding:3.2rem 2.4rem;text-align:center;overflow:hidden}
    .card h2,
    .news h2,
    .mission h2,
    .eventHeader,
    .afterpartyWrap h2,
    #donate-title,
    #staff-title,
    #elevation h2,
    #weather h2,
    .formCard h2{font-size:var(--h2);text-transform:uppercase;letter-spacing:.02em}

    .news{max-width:1100px;margin:2rem auto 0;background:var(--surface);border-radius:1rem;box-shadow:var(--shadow);padding:2rem}
    .news .badge{display:inline-block;background:#1f3b64;color:#cfe0ff;font-weight:800;letter-spacing:.1em;text-transform:uppercase;font-size:.7rem;padding:.35rem .6rem;border-radius:.4rem;margin-bottom:.75rem}
    .news p{line-height:1.75;margin:.4rem 0}
    .news a{color:#8db1ff;text-decoration:underline}

    /* small decorative images */
    .deco{position:absolute;opacity:.7;pointer-events:none;user-select:none;filter:drop-shadow(0 6px 10px rgba(0,0,0,.25))}
    .deco.leaf{width:60px;top:-12px;right:-12px;transform:rotate(-12deg)}
    .deco.mountain{width:70px;top:-16px;right:-16px}

    .postcard{display:grid;gap:2rem;background:var(--surface-2);border-radius:1rem;box-shadow:var(--shadow);padding:3rem;margin-bottom:4.5rem;max-width:1100px;margin-inline:auto}
    .postcard img{width:100%;border-radius:.9rem}
    @media(min-width:768px){.postcard{grid-template-columns:repeat(2,1fr);align-items:center}}

    /* Reveal animation */
    .reveal{opacity:0;transform:translateY(16px);transition:opacity .6s ease, transform .6s ease}
    .reveal.visible{opacity:1;transform:none}

    /* Tilt */
    .tilt{transform-style:preserve-3d;will-change:transform}
    .tilt:hover{transition:transform .12s ease}
    .tilt .pop{transform:translateZ(20px)}

    section[data-dark]{padding:4rem 2rem;text-align:center;background:#15284a}
    canvas{max-width:800px;width:100%;height:300px;margin:auto}
    #weatherCard{display:inline-block;background:#1a2e50;padding:2rem 2.5rem;border-radius:1rem;box-shadow:var(--shadow);min-width:260px}
    #weatherCard .t{font-size:2.4rem;font-weight:700}

    /* Mission */
    .mission{max-width:1100px;margin:4rem auto;background:var(--surface-2);border-radius:1rem;box-shadow:var(--shadow);padding:3rem;display:grid;gap:1.75rem}
    @media(min-width:900px){.mission{grid-template-columns:1.05fr 1fr;align-items:start}}
    .mission .badge{display:inline-block;background:var(--orange);color:#1b120a;font-weight:800;padding:.35rem .6rem;border-radius:.4rem;margin-bottom:.6rem;letter-spacing:.08em;text-transform:uppercase;font-size:.75rem}
    .mission .lede{color:var(--beige);font-size:1.05rem;line-height:1.6}
    .mission p{line-height:1.65}
    .btn-secondary{display:inline-block;border:2px solid var(--beige);color:var(--beige);padding:.75rem 1.25rem;border-radius:.55rem;font-weight:700;margin-top:.6rem}
    .btn-secondary:hover{opacity:.9}

    /* Event info */
    .eventWrap{max-width:1100px;margin:4rem auto;background:var(--surface-2);border-radius:1rem;box-shadow:var(--shadow);padding:3rem}
    .eventDate{color:var(--beige);font-size:1.05rem;margin:.5rem 0 1.25rem}
    .eventGrid{display:grid;gap:2rem}
    @media(min-width:900px){.eventGrid{grid-template-columns:1fr 1fr}}
    .eventCol h3{color:#8db1ff;font-size:1.05rem;margin:1.25rem 0 .5rem 0;letter-spacing:.02em}
    .eventCol p,.eventCol li{line-height:1.65}
    .eventCol ul{padding-left:1.1rem}
    .note{color:var(--muted);font-size:.95rem;margin-top:.5rem}
    .changed{color:#ff7a7a;font-weight:700}
    #meetMap{width:100%;height:220px;border-radius:.75rem;overflow:hidden;border:1px solid rgba(255,255,255,.12);margin-top:.5rem}

    /* Add-to-calendar buttons */
    .calGroup{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:1rem}
    .btnCal{display:inline-flex;align-items:center;gap:.4rem;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);padding:.55rem .8rem;border-radius:.55rem;font-weight:700}
    .btnCal:hover{background:rgba(255,255,255,.12)}
    .btnCal.primary{background:var(--orange);border-color:transparent;color:#1b120a}
    .btnCal svg{width:16px;height:16px;opacity:.9}

    /* After-party */
    .afterpartyWrap{max-width:1100px;margin:4rem auto;background:var(--surface);border-radius:1rem;box-shadow:var(--shadow);padding:3rem;display:grid;gap:1.75rem}
    @media(min-width:900px){.afterpartyWrap{grid-template-columns:1fr 420px;align-items:start}}
    .badgeUpdate{color:#ff6a6a;font-weight:800;margin-left:.5rem}
    .dl{margin-top:1.25rem;display:grid;grid-template-columns:110px 1fr;gap:.5rem 1.25rem}
    .dl dt{font-weight:700;color:#d1ddff}
    .dl dd{margin:0}
    .afterpartyLinks a{color:#8db1ff;text-decoration:underline}
    .afterpartyLinks a:hover{opacity:.9}
    .afterMedia img{border-radius:1rem;box-shadow:var(--shadow)}
    .afterMedia figcaption{color:#a5b4d4;font-size:.85rem;margin-top:.5rem}

    /* Donation */
    .donateWrap{max-width:1100px;margin:4rem auto;background:#1a2e50;border-radius:1rem;box-shadow:var(--shadow);padding:3rem;display:grid;gap:1rem}
    .donateWrap p{line-height:1.7}
    .btnWide{display:inline-block;padding:1.1rem 2.4rem;border-radius:.75rem;font-size:1.05rem;font-weight:800}
    .btnDonate{background:var(--orange);color:#1b120a}
    .btnDonate:hover{filter:brightness(.95)}

    /* Staff */
    .staffWrap{max-width:1100px;margin:4rem auto;background:var(--surface);border-radius:1rem;box-shadow:var(--shadow);padding:2.2rem}
    .staffGrid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:1.5rem;margin-top:1.2rem}
    @media(min-width:640px){.staffGrid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:900px){.staffGrid{grid-template-columns:repeat(4,1fr)}}
    .cardStaff{background:#0f203a;border:1px solid rgba(255,255,255,.08);border-radius:.9rem;overflow:hidden;display:flex;flex-direction:column;transition:transform .18s ease, box-shadow .18s ease}
    .cardStaff:hover{transform:translateY(-3px)}
    .cardStaff img{aspect-ratio:4/3;object-fit:cover;width:100%}
    .cardStaff .info{padding:.9rem 1rem}
    .cardStaff .name{font-weight:800}
    .chip{display:inline-block;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:.25rem .6rem;font-size:.75rem;margin-top:.35rem}

    /* Packing list */
    .packWrap{max-width:1100px;margin:4rem auto;background:var(--surface-2);border-radius:1rem;box-shadow:var(--shadow);padding:2rem}
    .packGrid{display:grid;gap:1rem;margin-top:1rem}
    @media(min-width:700px){.packGrid{grid-template-columns:repeat(2,1fr)}}
    .packItem{display:flex;align-items:flex-start;gap:.75rem;background:#0f203a;border:1px solid rgba(255,255,255,.08);border-radius:.75rem;padding:.8rem 1rem}
    .packItem input{margin-top:.2rem;transform:scale(1.1)}
    .packActions{display:flex;gap:.6rem;margin-top:1rem}
    .btnTiny{padding:.5rem .8rem;border-radius:.55rem;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);font-weight:700}
    .btnTiny:hover{background:rgba(255,255,255,.1)}
    .btnTiny.danger{border-color:transparent;background:#ff6a6a;color:#210b0b}

    /* Register */
    .formCard{max-width:1100px;margin:5rem auto;background:var(--surface);border-radius:1rem;box-shadow:var(--shadow);padding:3rem;text-align:center}
    .formCard form{max-width:680px;margin:auto}
    .formCard input,.formCard textarea{width:100%;padding:1rem;border:none;border-radius:.5rem;margin-top:.8rem;background:#172742;color:#fff}
    .formCard button{margin-top:1rem;background:var(--accent);color:#fff;border:none;padding:1rem 2rem;border-radius:.5rem;font-weight:700;width:100%}
    .formCard button:hover{opacity:.88}

    /* Footer */
    footer{background:#081425;color:#a5b4d4;text-align:center;padding:2.5rem 1rem;font-size:.85rem;font-style:italic}

    /* Z layers */
    nav{z-index:9999 !important}
    #progress{z-index:10000 !important}
    .leaflet-container{z-index:1 !important}
  </style>
</head>
<body>
<a href="#main" id="skip">Skip to content</a>
<div id="progress"></div>

<!-- ============================= NAV ============================= -->
<nav id="siteNav">
  <div class="brand">
    <img src="TPLOGO.png" alt="Japan Trek logo" />
  </div>

  <div class="links" role="navigation" aria-label="Primary">
    <a href="#news">News</a>
    <a href="#mission">Mission</a>
    <a href="#event">Event</a>
    <a href="#afterparty">After-Party</a>
    <a href="#donate" class="btn-nav secondary">Donate</a>
    <a href="#register" class="btn-nav primary">Register</a>
  </div>

  <div id="countBox" aria-live="polite"></div>
</nav>

<!-- ============================= HERO ============================= -->
<header id="hero" aria-label="Slideshow">
  <div class="swiper">
    <div class="swiper-wrapper">
      <div class="swiper-slide"><img src="20241109_c1_100.jpg" alt="Trailhead"><div class="caption">Trailhead meetup</div></div>
      <div class="swiper-slide"><img src="20241109_c2_024.jpg" alt="Camaraderie"><div class="caption">Camaraderie on the climb</div></div>
      <div class="swiper-slide"><img src="20241109_c2_031.jpg" alt="Shrine"><div class="caption">Shrine respite</div></div>
      <div class="swiper-slide"><img src="20241109_c2_041.jpg" alt="Switchbacks"><div class="caption">Forest switchbacks</div></div>
      <div class="swiper-slide"><img src="20241109_c2_052.jpg" alt="Summit"><div class="caption">Summit celebration</div></div>
    </div>
    <button id="prev" class="heroBtn" aria-label="Previous"><svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg></button>
    <button id="next" class="heroBtn" aria-label="Next"><svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg></button>
    <div class="swiper-pagination !bottom-8"></div>
    <div class="heroOverlay">
      <h1 class="pop">TransPerfect Charity Trek 2025</h1>
      <p>Hike, connect, give back.</p>
      <a href="#register" class="btn">Register Soon</a>
    </div>
  </div>
</header>

<div class="spacer"></div>

<main id="main">
  <!-- ============================= NEWS ============================= -->
  <section id="news" class="news tilt reveal" aria-labelledby="news-title">
    <img class="deco leaf" src="https://upload.wikimedia.org/wikipedia/commons/2/21/OpenMoji-color_15.0.0_1F341.svg" alt="" />
    <span class="badge">Trek News</span>
    <h2 id="news-title">TransPerfect Japan Charity Hike · Saturday, November 8</h2>
    <p>We’re excited to announce that TransPerfect Japan will be hosting a charity hiking event on <strong>Saturday, November 8</strong>.</p>
    <p><strong>Where are we going?</strong> Stay tuned. We will reveal the location soon. Not an extreme mountain.</p>
    <p>Over the past three years, we have welcomed more than <strong>80 participants</strong> each year, and the event keeps getting better. We add fun new activities annually, including last year’s popular after-party, and we continue to increase our <strong>donation</strong> contributions.</p>
    <p>The trail we choose is beginner-friendly. It is a fun challenge for everyone and a chance to connect with colleagues, invite family and friends, and even bring overseas managers.</p>
    <p>We hope you will join us for this meaningful day. Registration will open later. Thanks for bearing with us while we finalize details.</p>
    <p>Questions? Email <a href="mailto:TransPerfectJapanTrek@transperfect.com">TransPerfectJapanTrek@transperfect.com</a>.</p>
    <p>You, your family, and your friends are welcome. See you there.</p>
    <p style="margin-top:.6rem"><em>Sincerely, The TransPerfect Japan Trek Team</em></p>
  </section>

  <!-- ============================= REPO BANNER ============================= -->
  <section class="card tilt reveal" aria-label="Repository banner">
    <h2 class="pop">Reconnect in Nature</h2>
    <p>Challenge yourself on a scenic trail, forge new friendships, and raise funds for a worthy cause.</p>
  </section>

  <!-- ============================= MISSION ============================= -->
  <section id="mission" class="mission tilt reveal" aria-labelledby="mission-title">
    <div>
      <span class="badge">Our Mission</span>
      <h2 id="mission-title" class="pop">Giving Back, Together</h2>
      <p class="lede">One of the privileges of being a successful business is having the opportunity to give back. TransPerfect’s commitment to good corporate citizenship guides how we work every day.</p>
    </div>
    <div>
      <p>We support local communities and a diverse group of non-profit organizations. We also commit both time and money to our employees’ efforts to make a difference.</p>
      <p>This year, we are collaborating with <strong>Relay For Life</strong>. All proceeds will benefit Relay For Life for cancer patients. <a class="btn-secondary" href="https://www.cancer.org/involved/fundraise/relay-for-life.html" target="_blank" rel="noopener">Read more about Relay For Life</a></p>
    </div>
  </section>

  <!-- ============================= EVENT INFO ============================= -->
  <section id="event" class="eventWrap tilt reveal" aria-labelledby="event-title">
    <img class="deco mountain" src="https://upload.wikimedia.org/wikipedia/commons/8/83/OpenMoji-color_15.0.0_26F0.svg" alt="" />
    <h2 id="event-title" class="eventHeader pop">Event Information</h2>
    <p class="eventDate">Saturday, November 8, 2025</p>

    <div class="eventGrid">
      <div class="eventCol">
        <ul>
          <li>Time: 10:00 am to 5:00 pm. (Meeting Time: 9:30 am)</li>
          <li>Place: Mt. Takao (Tokyo)</li>
          <li>Participation Conditions: TransPerfect employee, employee’s family or friends</li>
        </ul>
        <p class="note">* Please bring water and some snacks.</p>
        <p class="note">* Transportation costs to and from the event are self covered.</p>

        <h3 id="after-party">After-Party</h3>
        <p>We will have an after-party this year. Please move to the restaurant after hiking. Details are below <a href="#afterparty">#afterparty</a>.</p>

        <h3>Registration Fee</h3>
        <ul>
          <li>TransPerfect employees: 1,000 JPY per person</li>
          <li>TransPerfect employee’s family: 2,000 JPY for the whole family including yourself. A common-law partner is considered as family.</li>
          <li>Non-TransPerfect members: 1,000 JPY per participant</li>
        </ul>
        <p class="note">Donation: Additional charity or charity-only participation is welcome.</p>
      </div>

      <div class="eventCol">
        <h3>Meeting Point</h3>
        <p class="changed">[Oct 30] Changed. Sakura Park</p>
        <div id="meetMap" aria-label="Map to Sakura Park"></div>

        <h3>Hiking Trail</h3>
        <ul><li>Ascending - Inariyama Trail, Descending - Trail 1 <em>* read more</em></li></ul>
        <p>Please feel free to ride the cable car if needed. We will meet up at the top of the mountain.</p>

        <h3>Prizes</h3>
        <p>Top three to the summit win:</p>
        <ul>
          <li>1st - Amazon Gift Card: 3,000 yen</li>
          <li>2nd - Amazon Gift Card: 2,000 yen</li>
          <li>3rd - Amazon Gift Card: 1,000 yen</li>
        </ul>
      </div>
    </div>

    <!-- Add-to-Calendar controls -->
    <div class="calGroup" aria-label="Add event to your calendar">
      <button class="btnCal primary" id="addCalMain">
        <!-- calendar icon -->
        <svg viewBox="0 0 24 24" fill="none"><path d="M7 2v3M17 2v3M3 9h18M5 6h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        Add .ics
      </button>
      <a class="btnCal" id="gcalMain" target="_blank" rel="noopener">Add to Google</a>
    </div>
  </section>

  <!-- ============================= AFTER-PARTY ============================= -->
  <section id="afterparty" class="afterpartyWrap tilt reveal" aria-labelledby="afterparty-title">
    <div>
      <h2 id="afterparty-title" class="pop">After-Party!</h2>
      <p>Join our after-party.</p>
      <p>The company will cover food and drinks for employees. For non-TPT employees, we will collect the money on-site. Adults: 5,500 JPY. Kids over 3: 3,000 JPY. <span class="badgeUpdate">[Nov 1] Fee for kids is revised.</span></p>
      <dl class="dl">
        <dt>Restaurant</dt><dd>バーガーズカフェ シュシュ</dd>
        <dt>Time</dt><dd>2:00 pm to 5:00 pm</dd>
        <dt>Phone</dt><dd><a class="afterpartyLinks" href="tel:0426733917">042-673-3917</a></dd>
        <dt>Address</dt><dd>1912 Takaomachi, Hachioji, Tokyo 193-0844</dd>
      </dl>
      <p class="afterpartyLinks" style="margin-top:.75rem"><a href="https://maps.app.goo.gl/3hZjhvUUbRsP5kPbW8" target="_blank" rel="noopener">Open in Google Maps</a></p>

      <!-- Add-to-Calendar controls (after-party) -->
      <div class="calGroup" aria-label="Add after-party to your calendar">
        <button class="btnCal primary" id="addCalAfter">
          <svg viewBox="0 0 24 24" fill="none"><path d="M7 2v3M17 2v3M3 9h18M5 6h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Add .ics
        </button>
        <a class="btnCal" id="gcalAfter" target="_blank" rel="noopener">Add to Google</a>
      </div>
    </div>

    <figure class="afterMedia">
      <img src="https://raw.githubusercontent.com/TPTREK/TPTREK/main/image.jpeg" alt="After-party venue interior" loading="lazy" decoding="async">
      <figcaption>After-party venue preview.</figcaption>
    </figure>
  </section>

  <!-- ============================= DONATION ============================= -->
  <section id="donate" class="donateWrap tilt reveal" aria-labelledby="donate-title">
    <h2 id="donate-title" class="pop">Donation Only</h2>
    <p>Charity-only participation is welcome!</p>
    <p>Please input the amount you are willing to donate from the organization’s page. Language can be changed from the top-right corner.</p>
    <p style="margin-top:.25rem"><a class="btnWide btnDonate" href="https://www.cancer.org/involved/fundraise/relay-for-life.html" target="_blank" rel="noopener">Donate now</a></p>
  </section>

  <!-- ============================= STAFF ============================= -->
  <section id="staff" class="staffWrap tilt reveal" aria-labelledby="staff-title">
    <h2 id="staff-title" class="pop">Our Staff</h2>
    <div class="staffGrid">
      <!-- Order as requested, with John last -->
      <article class="cardStaff">
        <img src="Norma-1.jpg" alt="Norma" />
        <div class="info">
          <div class="name">Norma</div>
          <div class="chip">Ambassador of Awesome</div>
        </div>
      </article>

      <article class="cardStaff">
        <img src="Yujiro.jpg" alt="Yujiro" />
        <div class="info">
          <div class="name">Yujiro</div>
          <div class="chip">Maestro of Mayhem</div>
        </div>
      </article>

      <article class="cardStaff">
        <img src="Peiyu.jpg" alt="Peiyu" />
        <div class="info">
          <div class="name">Peiyu</div>
          <div class="chip">Chief Inspiration Officer</div>
        </div>
      </article>

      <article class="cardStaff">
        <img src="Shotaro-2.jpg" alt="Shotaro" />
        <div class="info">
          <div class="name">Shotaro</div>
          <div class="chip">Happiness Hero</div>
        </div>
      </article>

      <article class="cardStaff">
        <img src="Shin-photo-1.jpg" alt="Shin" />
        <div class="info">
          <div class="name">Shin</div>
          <div class="chip">Guru</div>
        </div>
      </article>

      <article class="cardStaff">
        <img src="Nana.jpg" alt="Nana" />
        <div class="info">
          <div class="name">Nana</div>
          <div class="chip">Digital & Dream Architect</div>
        </div>
      </article>

      <article class="cardStaff">
        <img src="Waing.jpg" alt="Waing" />
        <div class="info">
          <div class="name">Waing</div>
          <div class="chip">Strategy Whisperer</div>
        </div>
      </article>

      <article class="cardStaff">
        <img src="john.jpg" alt="John" />
        <div class="info">
          <div class="name">John</div>
          <div class="chip">Trailblazer</div>
        </div>
      </article>
    </div>
  </section>

  <!-- ============================= HIGHLIGHTS ============================= -->
  <section id="gallery" class="reveal">
    <article class="postcard tilt"><img src="20241109_c2_024.jpg" alt="Trail camaraderie"><div><h2 style="font-size:var(--h2)" class="pop">Camaraderie</h2><p>Walk shoulder to shoulder with colleagues, friends, and family.</p></div></article>
    <article class="postcard tilt"><img src="20241109_c2_041.jpg" alt="Vista"><div><h2 style="font-size:var(--h2)" class="pop">Vistas</h2><p>Lookouts reveal sweeping skylines.</p></div></article>
  </section>

  <!-- ============================= PACKING LIST ============================= -->
  <section id="packing" class="packWrap reveal" aria-labelledby="pack-title">
    <h2 id="pack-title" class="pop">Packing List</h2>
    <div class="packGrid" id="packGrid">
      <label class="packItem"><input type="checkbox" data-key="water"><span>Water bottle or hydration pack</span></label>
      <label class="packItem"><input type="checkbox" data-key="snacks"><span>Snacks or light lunch</span></label>
      <label class="packItem"><input type="checkbox" data-key="shoes"><span>Comfortable hiking shoes</span></label>
      <label class="packItem"><input type="checkbox" data-key="layers"><span>Light layers / jacket</span></label>
      <label class="packItem"><input type="checkbox" data-key="sun"><span>Hat / sunscreen</span></label>
      <label class="packItem"><input type="checkbox" data-key="cash"><span>Transit card / small cash</span></label>
    </div>
    <div class="packActions">
      <button class="btnTiny" id="packCheckAll">Check all</button>
      <button class="btnTiny" id="packUncheckAll">Uncheck all</button>
      <button class="btnTiny danger" id="packReset">Reset saved list</button>
    </div>
  </section>

  <!-- ============================= ELEVATION ============================= -->
  <section id="elevation" data-dark class="reveal">
    <h2 class="pop">Elevation Profile</h2>
    <canvas id="chart" role="img" aria-label="Elevation graph"></canvas>
  </section>

  <!-- ============================= WEATHER ============================= -->
  <section id="weather" data-dark class="reveal">
    <h2 class="pop">Live Weather</h2>
    <div id="weatherCard"><p>Loading…</p></div>
  </section>

  <!-- ============================= REGISTER ============================= -->
  <section id="register" class="formCard reveal">
    <h2 class="pop">Register</h2>
    <form action="https://formspree.io/f/your-id" method="POST" id="regForm">
      <label class="sr-only">Name<input name="name" placeholder="Full Name" required /></label>
      <label class="sr-only">Email<input type="email" name="email" placeholder="Email" required /></label>
      <textarea rows="4" name="note" placeholder="Preferred date and time"></textarea>
      <button>Submit</button>
    </form>
  </section>
</main>

<footer>© 2025 TransPerfect · Japan Trek · Built with ✨ & ☕</footer>

<script>
/* ===== Helper: recompute anchor offset from *actual* nav height ===== */
const root = document.documentElement;
const navEl = document.getElementById('siteNav');
function setOffset(){ root.style.setProperty('--scroll-offset', (navEl.offsetHeight) + 'px'); }
setOffset(); addEventListener('resize', setOffset);

/* Precise anchor scrolling (accounts for live nav height) */
document.addEventListener('click', (e)=>{
  const a = e.target.closest('a[href^="#"]'); if(!a) return;
  const id = decodeURIComponent(a.getAttribute('href').slice(1));
  const target = id && document.getElementById(id); if(!target) return;
  e.preventDefault();
  const y = target.getBoundingClientRect().top + window.pageYOffset - navEl.offsetHeight;
  window.scrollTo({top:y, behavior:'smooth'});
  history.pushState(null,'','#'+id);
});

/* Progress + compact nav + active link */
const bar = document.getElementById('progress');
const navLinks = Array.from(document.querySelectorAll('nav .links a[href^="#"]'));
const sections = navLinks.map(a=>document.getElementById(a.getAttribute('href').slice(1))).filter(Boolean);

function setActive(){
  const y = scrollY + navEl.offsetHeight + 2;
  let cur = sections[0]?.id;
  for(const s of sections){ if(s.offsetTop <= y) cur = s.id; }
  navLinks.forEach(a => a.classList.toggle('is-active', a.getAttribute('href').slice(1) === cur));
}
function onScroll(){
  const max = document.body.scrollHeight - innerHeight;
  bar.style.transform = `scaleX(${Math.max(0, Math.min(1, scrollY / max))})`;
  navEl.classList.toggle('compact', scrollY > 80);
  setActive();

  // Hero parallax (subtle)
  const heroOverlay = document.querySelector('.heroOverlay');
  if(heroOverlay){
    const p = Math.min(1, Math.max(0, scrollY / innerHeight));
    heroOverlay.style.transform = `translateY(${p*20}px)`;
    heroOverlay.style.opacity = String(1 - p*0.15);
  }
}
addEventListener('scroll', onScroll, {passive:true});
addEventListener('load', ()=>{ onScroll(); setActive(); if(location.hash){ const el=document.getElementById(location.hash.slice(1)); if(el){ const y = el.getBoundingClientRect().top + pageYOffset - navEl.offsetHeight; scrollTo(0,y); }}});

/* Hero slider */
const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
const swiper = new Swiper('.swiper',{
  loop:true, preloadImages:false, lazy:{loadPrevNext:true},
  autoplay: reduce ? false : {delay:5200,disableOnInteraction:false},
  speed: reduce ? 0 : 900, effect: reduce ? 'slide' : 'fade',
  navigation:{nextEl:'#next',prevEl:'#prev'},
  pagination:{el:'.swiper-pagination',clickable:true}
});
// Arrow keys to control hero
addEventListener('keydown', (e)=>{
  if(e.key === 'ArrowRight') swiper.slideNext();
  if(e.key === 'ArrowLeft') swiper.slidePrev();
});

/* Countdown — Nov 8, 2025 09:30 JST (minimal + bold) */
const cb = document.getElementById('countBox');
cb.innerHTML = '<strong class="sr-only">Countdown</strong><span class="num" id="d"></span><span class="sep">:</span><span class="num" id="h"></span><span class="sep">:</span><span class="num" id="m"></span><span class="sep">:</span><span class="num" id="s"></span>';
const deadline = new Date('2025-11-08T09:30:00+09:00');
const d=document.getElementById('d'),h=document.getElementById('h'),m=document.getElementById('m'),s=document.getElementById('s');
const pad=n=>String(n).padStart(2,'0');
function parts(ms){return{d:Math.floor(ms/864e5),h:Math.floor(ms/36e5)%24,m:Math.floor(ms/6e4)%60,s:Math.floor(ms/1e3)%60}}
function tick(){ const r=deadline-Date.now(); if(r<=0){cb.textContent='Event Day!';return} const p=parts(r); d.textContent=pad(p.d); h.textContent=pad(p.h); m.textContent=pad(p.m); s.textContent=pad(p.s); }
tick(); setInterval(tick,1000);

/* Elevation chart */
new Chart('chart',{type:'line',
  data:{labels:['Start','Mid','Shrine','Summit'],
        datasets:[{data:[200,360,480,599],borderColor:'#d30000',backgroundColor:'rgba(211,0,0,.25)',fill:true,tension:.35}]},
  options:{plugins:{legend:{display:false}},
    scales:{x:{ticks:{color:'#c8d8f8'}},y:{ticks:{color:'#c8d8f8'}}}}
});

/* Weather */
fetch('https://api.open-meteo.com/v1/forecast?latitude=35.625&longitude=139.243&current_weather=true&timezone=Asia%2FTokyo')
  .then(r=>r.json()).then(({current_weather:t})=>{
    const label={0:'Clear',1:'Mainly clear',2:'Partly cloudy',3:'Overcast',45:'Fog',51:'Drizzle',61:'Rain',71:'Snow',95:'Thunderstorms'};
    document.getElementById('weatherCard').innerHTML =
      `<div class="t">${t.temperature}°C</div><p>${label[t.weathercode]||'Weather'}</p><p>${new Date(t.time).toLocaleTimeString('ja-JP',{hour:'2-digit',minute:'2-digit'})}</p>`;
  });

/* Meeting point map */
(function(){
  const el=document.getElementById('meetMap'); if(!el) return;
  const map=L.map(el,{zoomControl:false,scrollWheelZoom:false,dragging:true}).setView([35.6339,139.2434],15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap'}).addTo(map);
  L.marker([35.6339,139.2434],{title:'Sakura Park - Meeting Point'}).addTo(map).bindPopup('Sakura Park - Meeting Point');
})();

/* ===== Scroll reveal (IntersectionObserver) ===== */
const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
if(!prefersReduced){
  const io = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting){ e.target.classList.add('visible'); io.unobserve(e.target); }
    });
  },{threshold:.12});
  document.querySelectorAll('.reveal').forEach(el=>io.observe(el));
}

/* ===== 3D Tilt (subtle, respects reduced motion) ===== */
function addTilt(el){
  let rID=null;
  const strength=10; // deg
  function onMove(e){
    const rect = el.getBoundingClientRect();
    const px = (e.clientX - rect.left)/rect.width - .5;
    const py = (e.clientY - rect.top)/rect.height - .5;
    const rx = (+py)*strength, ry = (-px)*strength;
    cancelAnimationFrame(rID);
    rID = requestAnimationFrame(()=>{ el.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`; });
  }
  function reset(){ el.style.transform='rotateX(0) rotateY(0)'; }
  el.addEventListener('pointermove', onMove);
  el.addEventListener('pointerleave', reset);
}
if(!prefersReduced){
  document.querySelectorAll('.tilt').forEach(addTilt);
}

/* ===== Add-to-Calendar (ICS + Google) ===== */
function fmtICS(dt){ // Date -> YYYYMMDDTHHMMSSZ
  return dt.toISOString().replace(/[-:]/g,'').replace(/\.\d{3}Z$/,'Z');
}
function buildICS({title, start, end, location, description}){
  const cal = [
    'BEGIN:VCALENDAR',
    'VERSION:2.0',
    'PRODID:-//TransPerfect Japan Trek//EN',
    'CALSCALE:GREGORIAN',
    'METHOD:PUBLISH',
    'BEGIN:VEVENT',
    `UID:${Date.now()}@tptrek`,
    `DTSTAMP:${fmtICS(new Date())}`,
    `DTSTART:${fmtICS(start)}`,
    `DTEND:${fmtICS(end)}`,
    `SUMMARY:${title}`,
    `DESCRIPTION:${description.replace(/\n/g,'\\n')}`,
    `LOCATION:${location}`,
    'END:VEVENT',
    'END:VCALENDAR'
  ].join('\r\n');
  const blob = new Blob([cal], {type:'text/calendar'});
  const url = URL.createObjectURL(blob);
  return url;
}
function gcalURL({title,start,end,location,description}){
  const p = new URLSearchParams({
    action:'TEMPLATE',
    text:title,
    dates:`${fmtICS(start)}/${fmtICS(end)}`,
    details:description,
    location:location
  });
  return `https://calendar.google.com/calendar/render?${p.toString()}`;
}
// Main event times (JST -> convert to local automatically via Date)
const mainStart = new Date('2025-11-08T10:00:00+09:00');
const mainEnd   = new Date('2025-11-08T17:00:00+09:00');
const afterStart= new Date('2025-11-08T14:00:00+09:00');
const afterEnd  = new Date('2025-11-08T17:00:00+09:00');

const mainMeta = {
  title:'TransPerfect Charity Trek 2025',
  location:'Mt. Takao (Tokyo)',
  description:'Hike, connect, give back. Meeting 9:30; Event 10:00–17:00 (JST).'
};
const afterMeta = {
  title:'After-Party — TransPerfect Charity Trek 2025',
  location:'バーガーズカフェ シュシュ, 1912 Takaomachi, Hachioji, Tokyo 193-0844',
  description:'Company covers food/drinks for employees. Non-TPT: Adults 5,500 JPY, Kids 3,000 JPY.'
};

document.getElementById('addCalMain').addEventListener('click', ()=>{
  const url = buildICS({start:mainStart,end:mainEnd,...mainMeta});
  const a = Object.assign(document.createElement('a'),{href:url,download:'Trek-2025.ics'});
  document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url), 5000);
});
document.getElementById('gcalMain').setAttribute('href', gcalURL({start:mainStart,end:mainEnd,...mainMeta}));

document.getElementById('addCalAfter').addEventListener('click', ()=>{
  const url = buildICS({start:afterStart,end:afterEnd,...afterMeta});
  const a = Object.assign(document.createElement('a'),{href:url,download:'Trek-2025-AfterParty.ics'});
  document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url), 5000);
});
document.getElementById('gcalAfter').setAttribute('href', gcalURL({start:afterStart,end:afterEnd,...afterMeta}));

/* ===== Packing list persistence ===== */
const packGrid = document.getElementById('packGrid');
const KEY_PREFIX = 'tptrek-pack-';
function loadPack(){
  packGrid.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
    cb.checked = localStorage.getItem(KEY_PREFIX + cb.dataset.key) === '1';
  });
}
packGrid.addEventListener('change', (e)=>{
  const cb = e.target.closest('input[type="checkbox"]'); if(!cb) return;
  localStorage.setItem(KEY_PREFIX + cb.dataset.key, cb.checked ? '1' : '0');
});
document.getElementById('packCheckAll').addEventListener('click', ()=>{
  packGrid.querySelectorAll('input').forEach(cb=>{ cb.checked=true; localStorage.setItem(KEY_PREFIX + cb.dataset.key,'1'); });
});
document.getElementById('packUncheckAll').addEventListener('click', ()=>{
  packGrid.querySelectorAll('input').forEach(cb=>{ cb.checked=false; localStorage.setItem(KEY_PREFIX + cb.dataset.key,'0'); });
});
document.getElementById('packReset').addEventListener('click', ()=>{
  packGrid.querySelectorAll('input').forEach(cb=>{ cb.checked=false; localStorage.removeItem(KEY_PREFIX + cb.dataset.key); });
});
loadPack();

/* ===== Confetti on Register submit ===== */
const regForm = document.getElementById('regForm');
regForm.addEventListener('submit', ()=>{
  try{
    confetti({particleCount:120,spread:70,origin:{y:.6}});
    setTimeout(()=>confetti({particleCount:60,spread:90,origin:{y:.2}}), 150);
  }catch(e){}
});
</script>
</body>
</html>
