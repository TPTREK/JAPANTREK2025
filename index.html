<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Japan Trek 2025 | TransPerfect</title>

  <!-- Preconnect & fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

  <!-- Swiper / Leaflet / Chart.js (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/swiper@10/swiper-bundle.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/swiper@10/swiper-bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Critical styles -->
  <style>
    :root{
      --bg:#0e1a2b;--ink:#fff;--accent:#d30000;--beige:#e8dcc7;--muted:#a5b4d4;--shadow:0 12px 28px rgba(0,0,0,.15);
      --scroll-offset:72px; /* JS keeps this synced to the nav height */
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{font-family:Inter,sans-serif;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:auto;display:block}
    .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    /* Make every anchor target land just below the fixed nav */
    [id]{scroll-margin-top:var(--scroll-offset)}

    /* Skip-link */
    #skip{position:absolute;top:-40px;left:0;background:var(--accent);padding:.5rem 1rem;font-weight:700;z-index:200}
    #skip:focus{top:0}

    /* Progress bar */
    #progress{position:fixed;top:0;left:0;height:4px;background:var(--accent);transform-origin:0 0;z-index:120}

    /* ============== NAV (smaller; auto-compacts on scroll) ============== */
    nav{
      position:fixed;top:0;left:0;width:100%;
      min-height:48px;padding:.35rem .75rem;
      background:rgba(0,0,0,.9);backdrop-filter:blur(6px);
      display:flex;align-items:center;gap:.6rem;z-index:110;
      transition:min-height .18s ease,padding .18s ease,backdrop-filter .18s ease
    }
    nav .brand{display:flex;align-items:center;gap:.5rem}
    nav .brand img{width:150px;height:auto;transition:width .18s ease}
    nav .links{
      flex:1;display:flex;justify-content:center;
      gap:clamp(.5rem,2vw,1rem);font-size:.85rem;letter-spacing:.1em
    }
    nav .links a{font-weight:700;text-transform:uppercase;opacity:.9;transition:opacity .2s,color .2s}
    nav .links a:hover{opacity:1}
    /* Active section highlight */
    nav .links a.is-active{color:#fff;position:relative}
    nav .links a.is-active::after{
      content:"";position:absolute;left:0;right:0;bottom:-6px;height:2px;background:var(--accent);border-radius:2px
    }
    #countBox{display:flex;align-items:center;gap:.25rem;font-variant-numeric:tabular-nums}
    #countBox .num{font-weight:800;font-size:clamp(1rem,2.6vw,1.4rem);line-height:1}
    #countBox .sep{opacity:.6;margin:0 .1rem}

    /* Compact state after scroll */
    nav.compact{min-height:40px;padding:.2rem .6rem}
    nav.compact .brand img{width:120px}
    nav.compact .links{gap:.6rem;font-size:.78rem}
    nav.compact #countBox .num{font-size:clamp(.9rem,2.2vw,1.2rem)}

    /* ============== HERO (full viewport below nav) ============== */
    header{
      position:relative;overflow:hidden;
      margin-top:var(--scroll-offset);
      height:calc(100svh - var(--scroll-offset)); /* full screen minus nav */
      /* subtle decorative orbs */
      --orb: radial-gradient(600px 300px at 10% 15%, rgba(255,255,255,.06), transparent 60%),
             radial-gradient(500px 260px at 85% 75%, rgba(255,255,255,.05), transparent 60%);
      background-image: var(--orb);
      background-repeat:no-repeat;
    }
    .swiper{width:100%;height:100%}
    .swiper-slide img{width:100%;height:100%;object-fit:cover;transform:scale(1.02);will-change:transform}
    .heroBtn{position:absolute;top:50%;transform:translateY(-50%);width:56px;height:56px;border-radius:50%;background:rgba(255,255,255,.85);display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--shadow);z-index:10}
    .heroBtn svg{width:24px;height:24px;stroke:#000;stroke-width:2}
    #prev{left:1rem}#next{right:1rem}
    .heroOverlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.28),rgba(0,0,0,.5));display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;z-index:5;padding:0 1rem;perspective:1000px}
    .heroOverlay h1{font-size:clamp(2rem,5vw,3rem);letter-spacing:.08em;margin-bottom:.6rem;will-change:transform}
    .heroOverlay p{max-width:640px;margin-bottom:1.1rem;will-change:transform}
    .btn{display:inline-block;padding:.9rem 2rem;background:var(--ink);color:var(--bg);font-weight:700;border-radius:6px;will-change:transform}
    .btn:hover{opacity:.88}
    .caption{position:absolute;bottom:0;left:0;width:100%;padding:.75rem 1rem;font-size:.85rem;background:linear-gradient(0deg,rgba(0,0,0,.7),transparent);opacity:0;color:#fff;transition:.3s}
    .swiper-slide:hover .caption{opacity:1}

    /* Spacer after hero */
    .spacer{height:32px;background:var(--bg)}

    /* Repo banner (half-width) */
    .repoBanner{max-width:1100px;margin:1.2rem auto 0;padding:0 1rem}
    .repoBanner a{display:block;margin:0 auto;background:#0f203a;border:1px solid rgba(255,255,255,.12);border-radius:.9rem;overflow:hidden;box-shadow:var(--shadow);max-width:560px}

    /* Sections / cards */
    .card{max-width:1100px;margin:2rem auto;background:#12213a;border-radius:1.5rem;box-shadow:var(--shadow);padding:3.5rem 2.5rem;text-align:center}
    .card h2{font-size:clamp(1.8rem,4vw,2.5rem);margin-bottom:1rem;text-transform:uppercase}

    .news{max-width:1100px;margin:2rem auto 0;background:#12213a;border-radius:1.25rem;box-shadow:var(--shadow);padding:2rem}
    .news .badge{display:inline-block;background:#1f3b64;color:#cfe0ff;font-weight:800;letter-spacing:.1em;text-transform:uppercase;font-size:.7rem;padding:.35rem .6rem;border-radius:.4rem;margin-bottom:.75rem}
    .news h2{font-size:clamp(1.4rem,3.4vw,2rem);margin-bottom:.4rem}
    .news p{line-height:1.75;margin:.4rem 0}
    .news a{color:#8db1ff;text-decoration:underline}

    .postcard{display:grid;gap:2rem;background:#172742;border-radius:1rem;box-shadow:var(--shadow);padding:3rem;margin-bottom:4.5rem;max-width:1100px;margin-inline:auto;transform-style:preserve-3d;will-change:transform}
    .postcard img{width:100%;border-radius:.9rem}
    @media(min-width:768px){.postcard{grid-template-columns:repeat(2,1fr);align-items:center}}

    section[data-dark]{padding:4rem 2rem;text-align:center;background:#15284a}
    canvas{max-width:800px;width:100%;height:300px;margin:auto}
    #weatherCard{display:inline-block;background:#1a2e50;padding:2rem 2.5rem;border-radius:1rem;box-shadow:var(--shadow);min-width:260px}
    #weatherCard .t{font-size:2.4rem;font-weight:700}

    .formCard{max-width:1100px;margin:5rem auto;background:#12213a;border-radius:1.5rem;box-shadow:var(--shadow);padding:4rem 3rem;text-align:center}
    .formCard input,.formCard textarea{width:100%;padding:1rem;border:none;border-radius:.5rem;margin-top:.8rem;background:#172742;color:#fff}
    .formCard button{margin-top:1rem;background:var(--accent);color:#fff;border:none;padding:1rem 2rem;border-radius:.5rem;font-weight:700;width:100%}
    .formCard button:hover{opacity:.88}

    /* Mission */
    .mission{max-width:1100px;margin:4rem auto;background:#172742;border-radius:1.25rem;box-shadow:var(--shadow);padding:3rem;display:grid;gap:1.75rem;transform-style:preserve-3d}
    @media(min-width:900px){.mission{grid-template-columns:1.05fr 1fr;align-items:start}}
    .mission .badge{display:inline-block;background:var(--accent);color:#fff;font-weight:700;padding:.35rem .6rem;border-radius:.4rem;margin-bottom:.6rem;letter-spacing:.08em;text-transform:uppercase;font-size:.75rem}
    .mission h2{font-size:clamp(1.6rem,3.4vw,2.2rem);margin-bottom:.4rem;text-transform:uppercase}
    .mission .lede{color:var(--beige);font-size:1.05rem;line-height:1.6}
    .mission p{line-height:1.65}
    .btn-secondary{display:inline-block;border:2px solid var(--beige);color:var(--beige);padding:.75rem 1.25rem;border-radius:.55rem;font-weight:700;margin-top:.6rem}
    .btn-secondary:hover{opacity:.9}

    /* Event info */
    .eventWrap{max-width:1100px;margin:4rem auto;background:#172742;border-radius:1.25rem;box-shadow:var(--shadow);padding:3rem;transform-style:preserve-3d}
    .eventHeader{font-size:clamp(1.6rem,3.4vw,2.2rem);text-transform:uppercase;margin-bottom:.35rem}
    .eventDate{color:var(--beige);font-size:1.1rem;margin-bottom:1rem}
    .eventGrid{display:grid;gap:2rem}
    @media(min-width:900px){.eventGrid{grid-template-columns:1fr 1fr}}
    .eventCol h3{color:#8db1ff;font-size:1.15rem;margin:1.25rem 0 .5rem 0;letter-spacing:.02em}
    .eventCol p,.eventCol li{line-height:1.65}
    .eventCol ul{padding-left:1.1rem}
    .note{color:var(--muted);font-size:.95rem;margin-top:.5rem}
    .changed{color:#ff7a7a;font-weight:700}
    #meetMap{width:100%;height:220px;border-radius:.75rem;overflow:hidden;border:1px solid rgba(255,255,255,.12);margin-top:.5rem}

    /* Add-to-calendar row */
    .icalRow{display:flex;flex-wrap:wrap;gap:.6rem;margin:1rem 0 1.25rem}
    .btnCal{cursor:pointer;border:none;background:#fff;color:#0a1222;font-weight:800;border-radius:.6rem;padding:.6rem 1rem}
    .btnCal.outline{background:transparent;border:2px solid #cbd5ff;color:#cbd5ff}

    /* Packing list */
    .packWrap{max-width:1100px;margin:1rem auto 0;background:#12213a;border-radius:1rem;box-shadow:var(--shadow);padding:1.25rem 1.25rem 1.5rem}
    .packHead{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem}
    .packHead h3{font-size:1.1rem;letter-spacing:.04em}
    .packActions{display:flex;gap:.6rem}
    .packActions button{background:transparent;border:1px solid rgba(255,255,255,.25);color:#cfe0ff;border-radius:.5rem;padding:.35rem .7rem;font-size:.85rem;cursor:pointer}
    .packGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.35rem .75rem}
    .packItem{display:flex;align-items:center;gap:.6rem;background:#172742;border-radius:.6rem;padding:.55rem .7rem}
    .packItem input{width:18px;height:18px}

    /* After-party (with image) */
    .afterpartyWrap{max-width:1100px;margin:4rem auto;background:#12213a;border-radius:1.25rem;box-shadow:var(--shadow);padding:3rem;display:grid;gap:1.75rem;transform-style:preserve-3d}
    @media(min-width:900px){.afterpartyWrap{grid-template-columns:1fr 420px;align-items:start}}
    .afterpartyWrap h2{font-size:clamp(1.8rem,4vw,2.6rem);letter-spacing:.02em;margin-bottom:.75rem}
    .badgeUpdate{color:#ff6a6a;font-weight:800;margin-left:.5rem}
    .dl{margin-top:1.25rem;display:grid;grid-template-columns:110px 1fr;gap:.5rem 1.25rem}
    .dl dt{font-weight:700;color:#d1ddff}
    .dl dd{margin:0}
    .afterpartyLinks a{color:#8db1ff;text-decoration:underline}
    .afterpartyLinks a:hover{opacity:.9}
    .afterMedia img{border-radius:1rem;box-shadow:var(--shadow);will-change:transform;transform-style:preserve-3d}
    .afterMedia figcaption{color:#a5b4d4;font-size:.85rem;margin-top:.5rem}

    /* Donation */
    .donateWrap{max-width:1100px;margin:4rem auto;background:#1a2e50;border-radius:1.25rem;box-shadow:var(--shadow);padding:3rem;display:grid;grid-template-columns:1fr;gap:1rem;transform-style:preserve-3d}
    .donateWrap h2{font-size:clamp(1.8rem,4vw,2.4rem);letter-spacing:.02em;margin-bottom:.25rem}
    .donateWrap p{line-height:1.7}
    .btnWide{display:inline-block;padding:1.1rem 2.4rem;border-radius:.75rem;font-size:1.05rem;font-weight:800;margin-top:.5rem}
    .btnDonate{background:#6faefb;color:#061321}
    .btnDonate:hover{opacity:.92}

    /* Footer */
    footer{background:#081425;color:#a5b4d4;text-align:center;padding:2.5rem 1rem;font-size:.85rem;font-style:italic}

    /* ===== Reveal animations ===== */
    .reveal{opacity:0;transform:translateY(16px) scale(.98);transition:opacity .6s ease, transform .8s cubic-bezier(.2,.8,.2,1);will-change:transform,opacity}
    .reveal.in{opacity:1;transform:none}

    /* ===== Tilt hover ===== */
    .tilt{will-change:transform;transform-style:preserve-3d;transition:transform .12s ease}
    .tilt .tilt-child{transform:translateZ(40px)}
    .no-motion .tilt,.no-motion .postcard,.no-motion .afterMedia img,.no-motion .heroOverlay *{transform:none !important;transition:none !important}

    /* ===== Confetti canvas ===== */
    #confetti{position:fixed;inset:0;pointer-events:none;z-index:2000}
    /* ===== Z-INDEX FIXES (keep nav above Leaflet) ===== */
    nav{ z-index:9999 !important; }
    #progress{ z-index:10000 !important; }
    .leaflet-container{ z-index:1 !important; } /* container sits below fixed header */
  </style>
</head>
<body>
<a href="#main" id="skip">Skip to content</a>
<div id="progress"></div>

<!-- NAVIGATION -->
<nav>
  <div class="brand">
    <img src="Logos_TPT_JapanTrek_center_colour-03.png" alt="Japan Trek logo">
  </div>
  <div class="links">
    <a href="#news">News</a>
    <a href="#mission">Mission</a>
    <a href="#event">Event</a>
    <a href="#afterparty">After-Party</a>
    <a href="#donate">Donate</a>
    <a href="#register">Register</a>
  </div>
  <!-- Minimal bold countdown -->
  <div id="countBox" aria-live="polite"></div>
</nav>

<!-- HERO (full viewport below nav) -->
<header id="hero" aria-label="Slideshow">
  <div class="swiper">
    <div class="swiper-wrapper">
      <div class="swiper-slide"><img src="20241109_c1_100.jpg" alt="Trailhead"><div class="caption">Trailhead meetup</div></div>
      <div class="swiper-slide"><img src="20241109_c2_024.jpg" alt="Camaraderie"><div class="caption">Camaraderie on the climb</div></div>
      <div class="swiper-slide"><img src="20241109_c2_031.jpg" alt="Shrine"><div class="caption">Shrine respite</div></div>
      <div class="swiper-slide"><img src="20241109_c2_041.jpg" alt="Switchbacks"><div class="caption">Forest switchbacks</div></div>
      <div class="swiper-slide"><img src="20241109_c2_052.jpg" alt="Summit"><div class="caption">Summit celebration</div></div>
    </div>
    <button id="prev" class="heroBtn" aria-label="Previous"><svg viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6"/></svg></button>
    <button id="next" class="heroBtn" aria-label="Next"><svg viewBox="0 0 24 24" fill="none"><path d="M9 18l6-6-6-6"/></svg></button>
    <div class="swiper-pagination !bottom-8"></div>
    <div class="heroOverlay">
      <h1 class="parallax">TransPerfect Charity Trek 2025</h1>
      <p class="parallax">Hike, connect, give back.</p>
      <a href="#register" class="btn parallax">Register Soon</a>
    </div>
  </div>
</header>

<div class="spacer"></div>

<main id="main">
  <!-- TREK NEWS -->
  <section id="news" class="news reveal" aria-labelledby="news-title">
    <span class="badge">Trek News</span>
    <h2 id="news-title">TransPerfect Japan Charity Hike · Saturday, November 8</h2>
    <p>We’re excited to announce that TransPerfect Japan will be hosting a charity hiking event on <strong>Saturday, November 8</strong>.</p>
    <p><strong>Where are we going?</strong> Stay tuned. We will reveal the location soon. Not an extreme mountain.</p>
    <p>Over the past three years, we have welcomed more than <strong>80 participants</strong> each year, and the event keeps getting better. We add fun new activities annually, including last year’s popular after-party, and we continue to increase our <strong>donation</strong> contributions.</p>
    <p>The trail we choose is beginner-friendly. It is a fun challenge for everyone and a chance to connect with colleagues, invite family and friends, and even bring overseas managers.</p>
    <p>We hope you will join us for this meaningful day. Registration will open later. Thanks for bearing with us while we finalize details.</p>
    <p>Questions? Email <a href="mailto:TransPerfectJapanTrek@transperfect.com">TransPerfectJapanTrek@transperfect.com</a>.</p>
    <p>You, your family, and your friends are welcome. See you there.</p>
    <p style="margin-top:.6rem"><em>Sincerely, The TransPerfect Japan Trek Team</em></p>
  </section>

  <!-- Repo banner -->
  <section class="repoBanner reveal" aria-label="Repository banner">
    <a href="https://github.com/TPTREK/TPTREK/blob/main/54592b06831316e137faccd90187a44534f03028349ace05aadece2b352baccf.png" target="_blank" rel="noopener">
      <img src="https://raw.githubusercontent.com/TPTREK/TPTREK/main/54592b06831316e137faccd90187a44534f03028349ace05aadece2b352baccf.png" alt="TPTREK repository graphic">
    </a>
  </section>

  <!-- ABOUT -->
  <section id="about" class="card reveal tilt">
    <h2 class="tilt-child">Reconnect in Nature</h2>
    <p>Challenge yourself on a scenic trail, forge new friendships, and raise funds for a worthy cause.</p>
  </section>

  <!-- MISSION -->
  <section id="mission" class="mission reveal tilt" aria-labelledby="mission-title">
    <div class="mission-head tilt-child">
      <span class="badge">Our Mission</span>
      <h2 id="mission-title">Giving Back, Together</h2>
      <p class="lede">One of the privileges of being a successful business is having the opportunity to give back. TransPerfect’s commitment to good corporate citizenship guides how we work every day.</p>
    </div>
    <div class="mission-body">
      <p>We support local communities and a diverse group of non-profit organizations. We also commit both time and money to our employees’ efforts to make a difference.</p>
      <p>This year, we are collaborating with <strong>Relay For Life</strong>. All proceeds will benefit Relay For Life for cancer patients. <a class="btn-secondary" href="https://www.cancer.org/involved/fundraise/relay-for-life.html" target="_blank" rel="noopener">Read more about Relay For Life</a></p>
    </div>
  </section>

  <!-- EVENT INFO -->
  <section id="event" class="eventWrap reveal tilt" aria-labelledby="event-title">
    <h2 id="event-title" class="eventHeader tilt-child">Event Information</h2>
    <p class="eventDate">Saturday, November 8, 2025</p>

    <!-- Add-to-calendar -->
    <div class="icalRow">
      <button class="btnCal" id="addGoogle" type="button" aria-label="Add to Google Calendar">Add to Google</button>
      <button class="btnCal outline" id="downloadICS" type="button" aria-label="Download iCalendar file">Download .ics</button>
    </div>

    <div class="eventGrid">
      <div class="eventCol">
        <ul>
          <li>Time: 10:00 am to 5:00 pm. (Meeting Time: 9:30 am)</li>
          <li>Place: Mt. Takao (Tokyo)</li>
          <li>Participation Conditions: TransPerfect employee, employee’s family or friends</li>
        </ul>
        <p class="note">* Please bring water and some snacks.</p>
        <p class="note">* Transportation costs to and from the event are self covered.</p>

        <h3 id="after-party">After-Party</h3>
        <p>We will have an after-party this year. Please move to the restaurant after hiking. Details are below <a href="#afterparty">#afterparty</a>.</p>

        <h3>Registration Fee</h3>
        <ul>
          <li>TransPerfect employees: 1,000 JPY per person</li>
          <li>TransPerfect employee’s family: 2,000 JPY for the whole family including yourself. A common-law partner is considered as family.</li>
          <li>Non-TransPerfect members: 1,000 JPY per participant</li>
        </ul>
        <p class="note">Donation: Additional charity or charity-only participation is welcome.</p>
      </div>

      <div class="eventCol">
        <h3>Meeting Point</h3>
        <p class="changed">[Oct 30] Changed. Sakura Park</p>
        <div id="meetMap" aria-label="Map to Sakura Park"></div>

        <h3>Hiking Trail</h3>
        <ul><li>Ascending - Inariyama Trail, Descending - Trail 1 <em>* read more</em></li></ul>
        <p>Please feel free to ride the cable car if needed. We will meet up at the top of the mountain.</p>

        <h3>Prizes</h3>
        <p>Top three to the summit win:</p>
        <ul>
          <li>1st - Amazon Gift Card: 3,000 yen</li>
          <li>2nd - Amazon Gift Card: 2,000 yen</li>
          <li>3rd - Amazon Gift Card: 1,000 yen</li>
        </ul>
      </div>
    </div>

    <!-- Packing list -->
    <div class="packWrap reveal" id="packing">
      <div class="packHead">
        <h3>Packing List</h3>
        <div class="packActions">
          <button type="button" id="markAll">Mark all</button>
          <button type="button" id="resetAll">Reset</button>
        </div>
      </div>
      <div class="packGrid" id="packGrid" aria-live="polite"></div>
    </div>
  </section>

  <!-- AFTER-PARTY -->
  <section id="afterparty" class="afterpartyWrap reveal tilt" aria-labelledby="afterparty-title">
    <div class="tilt-child">
      <h2 id="afterparty-title">Get together for an after-party</h2>
      <p>Join our after-party.</p>
      <p>The company will cover food and drinks for employees. For non-TPT employees, we will collect the money on-site. Adults: 5,500 JPY. Kids over 3: 3,000 JPY. <span class="badgeUpdate">[Nov 1] Fee for kids is revised.</span></p>
      <dl class="dl">
        <dt>Restaurant</dt><dd>バーガーズカフェ シュシュ</dd>
        <dt>Time</dt><dd>2:00 pm to 5:00 pm</dd>
        <dt>Phone</dt><dd><a class="afterpartyLinks" href="tel:0426733917">042-673-3917</a></dd>
        <dt>Address</dt><dd>1912 Takaomachi, Hachioji, Tokyo 193-0844</dd>
      </dl>
      <p class="afterpartyLinks" style="margin-top:.75rem"><a href="https://maps.app.goo.gl/3hZjhvUUbRsP5kPbW8" target="_blank" rel="noopener">Open in Google Maps</a></p>
    </div>

    <figure class="afterMedia tilt">
      <img class="tilt-child" src="https://raw.githubusercontent.com/TPTREK/TPTREK/main/image.jpeg" alt="After-party venue interior" loading="lazy" decoding="async">
      <figcaption>After-party venue preview.</figcaption>
    </figure>
  </section>

  <!-- DONATION -->
  <section id="donate" class="donateWrap reveal tilt" aria-labelledby="donate-title">
    <h2 id="donate-title" class="tilt-child">Donation Only</h2>
    <p>Charity-only participation is welcome.</p>
    <p>Please input the amount you are willing to donate from the organization’s page. Language can be changed from the top-right corner.</p>
    <p><a class="btnWide btnDonate" href="https://www.cancer.org/involved/fundraise/relay-for-life.html" target="_blank" rel="noopener">Donate now</a></p>
  </section>

  <!-- HIGHLIGHTS -->
  <section id="gallery" class="reveal">
    <article class="postcard tilt"><img class="tilt-child" src="20241109_c2_024.jpg" alt="Trail camaraderie"><div><h3>Camaraderie</h3><p>Walk shoulder to shoulder with colleagues, friends, and family.</p></div></article>
    <article class="postcard tilt"><img class="tilt-child" src="20241109_c2_041.jpg" alt="Vista"><div><h3>Vistas</h3><p>Lookouts reveal sweeping skylines.</p></div></article>
  </section>

  <!-- ELEVATION -->
  <section id="elevation" class="reveal" data-dark><h2>Elevation Profile</h2><canvas id="chart" role="img" aria-label="Elevation graph"></canvas></section>

  <!-- WEATHER -->
  <section id="weather" class="reveal" data-dark><h2>Live Weather</h2><div id="weatherCard"><p>Loading…</p></div></section>

  <!-- REGISTER -->
  <section id="register" class="formCard reveal tilt"><h2 class="tilt-child">Register</h2>
    <form action="https://formspree.io/f/your-id" method="POST" id="regForm">
      <label class="sr-only" for="name">Name</label>
      <input id="name" name="name" placeholder="Full Name" required autocomplete="name">
      <label class="sr-only" for="email">Email</label>
      <input id="email" type="email" name="email" placeholder="Email" required autocomplete="email">
      <label class="sr-only" for="note">Preferred date and time</label>
      <textarea id="note" rows="4" name="note" placeholder="Preferred date and time"></textarea>
      <button type="submit">Submit</button>
    </form>
  </section>
</main>

<footer>© 2025 TransPerfect · Japan Trek · Built with ✨ & ☕</footer>

<canvas id="confetti" width="0" height="0" aria-hidden="true"></canvas>

<!-- Scripts -->
<script>
/* ===== Dynamic anchor offset (hash targets land below the fixed nav) ===== */
const root = document.documentElement;
const navEl = document.querySelector('nav');
function getOffset(){ return (navEl?.offsetHeight || 48) + 8 } // nav height + small padding
function setOffsetVar(){ root.style.setProperty('--scroll-offset', getOffset() + 'px') }
setOffsetVar();
addEventListener('resize', setOffsetVar);

/* Smooth, precise anchor scrolling */
document.addEventListener('click', (e)=>{
  const a = e.target.closest('a[href^="#"]');
  if(!a) return;
  const id = decodeURIComponent(a.getAttribute('href').slice(1));
  const target = id ? document.getElementById(id) : null;
  if(target){
    e.preventDefault();
    const y = target.getBoundingClientRect().top + window.pageYOffset - getOffset();
    window.scrollTo({top:y, behavior:'smooth'});
    history.pushState(null, '', '#' + id);
  }
});

/* Adjust initial hash position on load */
addEventListener('load', ()=>{
  if(location.hash){
    const el = document.getElementById(location.hash.slice(1));
    if(el){
      const y = el.getBoundingClientRect().top + window.pageYOffset - getOffset();
      window.scrollTo(0, y);
    }
  }
});

/* ===== Compact nav + progress + active-link highlight ===== */
const bar = document.getElementById('progress');
const navLinks = Array.from(document.querySelectorAll('nav .links a[href^="#"]'));
const sections = navLinks
  .map(a => document.getElementById(a.getAttribute('href').slice(1)))
  .filter(Boolean);

function setActive() {
  const y = window.scrollY + getOffset() + 2;
  let currentId = sections[0]?.id;
  for (const sec of sections) {
    if (sec.offsetTop <= y) currentId = sec.id;
  }
  navLinks.forEach(a => {
    const on = a.getAttribute('href').slice(1) === currentId;
    a.classList.toggle('is-active', on);
    a.setAttribute('aria-current', on ? 'page' : 'false');
  });
}

function onScroll() {
  // progress bar
  const max = document.body.scrollHeight - innerHeight;
  bar.style.transform = `scaleX(${Math.max(0, Math.min(1, scrollY / max))})`;

  // compact nav after 100px
  const compact = window.scrollY > 100;
  if (compact !== navEl.classList.contains('compact')) {
    navEl.classList.toggle('compact', compact);
    setOffsetVar(); // keep anchor offset accurate if nav height changes
  }

  // active section
  setActive();
}
addEventListener('scroll', onScroll, {passive:true});
addEventListener('load', ()=>{ onScroll(); setActive(); });
addEventListener('resize', ()=>{ setActive(); });

/* ===== Hero (Swiper) ===== */
const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
const hero = new Swiper('.swiper', {
  loop:true, preloadImages:false, lazy:{loadPrevNext:true},
  autoplay: prefersReduced ? false : {delay:5200,disableOnInteraction:false},
  speed: prefersReduced ? 0 : 900, effect: prefersReduced ? 'slide' : 'fade',
  navigation:{nextEl:'#next',prevEl:'#prev'},
  pagination:{el:'.swiper-pagination',clickable:true}
});

/* ===== Countdown — Nov 8, 2025 09:30 JST ===== */
const cb = document.getElementById('countBox');
cb.innerHTML = '<strong class="sr-only">Countdown</strong><span class="num" id="d"></span><span class="sep">:</span><span class="num" id="h"></span><span class="sep">:</span><span class="num" id="m"></span><span class="sep">:</span><span class="num" id="s"></span>';
const deadline = new Date('2025-11-08T09:30:00+09:00');
const d=document.getElementById('d'), h=document.getElementById('h'), m=document.getElementById('m'), s=document.getElementById('s');
const pad=n=>String(n).padStart(2,'0');
function parts(ms){return{d:Math.floor(ms/864e5),h:Math.floor(ms/36e5)%24,m:Math.floor(ms/6e4)%60,s:Math.floor(ms/1e3)%60}}
function tick(){
  const r = deadline - Date.now();
  if(r<=0){ cb.textContent='Event Day!'; return }
  const p = parts(r); d.textContent=pad(p.d); h.textContent=pad(p.h); m.textContent=pad(p.m); s.textContent=pad(p.s);
}
tick(); setInterval(tick,1000);

/* ===== Elevation chart ===== */
new Chart('chart',{
  type:'line',
  data:{labels:['Start','Mid','Shrine','Summit'],
        datasets:[{data:[200,360,480,599],borderColor:'#d30000',backgroundColor:'rgba(211,0,0,.25)',fill:true,tension:.35}]},
  options:{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#c8d8f8'}},y:{ticks:{color:'#c8d8f8'}}}}
});

/* ===== Weather ===== */
fetch('https://api.open-meteo.com/v1/forecast?latitude=35.625&longitude=139.243&current_weather=true&timezone=Asia%2FTokyo')
 .then(r=>r.json()).then(({current_weather:t})=>{
   const labels={0:'Clear',1:'Mainly clear',2:'Partly cloudy',3:'Overcast',45:'Fog',51:'Drizzle',61:'Rain',71:'Snow',95:'Thunderstorms'};
   document.getElementById('weatherCard').innerHTML =
     `<div class="t">${t.temperature}°C</div><p>${labels[t.weathercode]||'Weather'}</p><p>${new Date(t.time).toLocaleTimeString('ja-JP',{hour:'2-digit',minute:'2-digit'})}</p>`;
 });

/* ===== Meeting point map (Leaflet) ===== */
(function(){
  const el=document.getElementById('meetMap'); if(!el) return;
  const map=L.map(el,{zoomControl:false,scrollWheelZoom:false,dragging:true}).setView([35.6339,139.2434],15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap'}).addTo(map);
  L.marker([35.6339,139.2434],{title:'Sakura Park - Meeting Point'}).addTo(map).bindPopup('Sakura Park - Meeting Point');
})();

/* ===== Add-to-calendar ===== */
(function(){
  const title = 'TransPerfect Charity Trek 2025';
  const details = 'Hike, connect, give back. Meeting 9:30, hike 10:00-17:00. Location: Mt. Takao (Tokyo).';
  // Times: 2025-11-08 10:00-17:00 JST -> 01:00-08:00 UTC
  const startUTC = '20251108T010000Z';
  const endUTC   = '20251108T080000Z';
  const loc = 'Mt. Takao (Tokyo)';

  // Google Calendar
  const gLink = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${startUTC}%2F${endUTC}&location=${encodeURIComponent(loc)}&details=${encodeURIComponent(details)}`;
  document.getElementById('addGoogle').addEventListener('click', ()=> window.open(gLink, '_blank','noopener'));

  // ICS generator
  function downloadICS(){
    const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//TransPerfect//Japan Trek 2025//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${Date.now()}-tptrek@transperfect.com
DTSTAMP:${new Date().toISOString().replace(/[-:]/g,'').replace(/\.\d{3}Z$/,'Z')}
DTSTART:${startUTC}
DTEND:${endUTC}
SUMMARY:${title}
DESCRIPTION:${details}
LOCATION:${loc}
END:VEVENT
END:VCALENDAR`;
    const blob = new Blob([ics],{type:'text/calendar;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'TransPerfect-JapanTrek-2025.ics';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }
  document.getElementById('downloadICS').addEventListener('click', downloadICS);
})();

/* ===== Packing list (persist to localStorage) ===== */
(function(){
  const items = [
    'Water bottle / hydration',
    'Snacks / onigiri',
    'Light layers / fleece',
    'Rain jacket / poncho',
    'Cap / beanie',
    'Sunscreen',
    'Comfortable shoes',
    'PASMO / Suica',
    'Cash / IC backup',
    'Phone + portable battery',
    'Small towel',
    'Personal meds',
    'Emergency contact info'
  ];
  const key='packlist-v1';
  const saved = JSON.parse(localStorage.getItem(key) || '[]');
  const grid = document.getElementById('packGrid');
  items.forEach((label,i)=>{
    const wrap=document.createElement('label');
    wrap.className='packItem';
    const cb=document.createElement('input');
    cb.type='checkbox'; cb.checked = !!saved[i];
    cb.addEventListener('change', ()=>{
      const state = Array.from(grid.querySelectorAll('input')).map(x=>x.checked);
      localStorage.setItem(key, JSON.stringify(state));
    });
    const span=document.createElement('span'); span.textContent=label;
    wrap.append(cb,span); grid.appendChild(wrap);
  });
  document.getElementById('markAll').onclick=()=>{
    grid.querySelectorAll('input').forEach(i=>i.checked=true);
    localStorage.setItem(key, JSON.stringify(Array(items.length).fill(true)));
  };
  document.getElementById('resetAll').onclick=()=>{
    grid.querySelectorAll('input').forEach(i=>i.checked=false);
    localStorage.setItem(key, JSON.stringify(Array(items.length).fill(false)));
  };
})();

/* ===== Reveal-on-scroll (IntersectionObserver) ===== */
(function(){
  const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if(reduced){ document.body.classList.add('no-motion'); return; }
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target); }
    });
  },{threshold:.18});
  document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
})();

/* ===== Parallax micro-motion in hero ===== */
(function(){
  const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if(reduced) return;
  const layerEls = Array.from(document.querySelectorAll('.heroOverlay .parallax'));
  const max = 20; // px
  function onMove(e){
    const {innerWidth:w, innerHeight:h} = window;
    const x = (e.clientX - w/2) / (w/2);
    const y = (e.clientY - h/2) / (h/2);
    layerEls.forEach((el,idx)=>{
      const depth = (idx+1)/layerEls.length;
      el.style.transform = `translate3d(${-(x*max*depth)}px, ${-(y*max*depth)}px, 0)`;
    });
  }
  window.addEventListener('mousemove', onMove);
})();

/* ===== 3D tilt on cards/images ===== */
(function(){
  const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if(reduced){ document.body.classList.add('no-motion'); return; }
  const els = document.querySelectorAll('.tilt, .postcard, .afterMedia img');
  els.forEach(el=>{
    const bounds = ()=> el.getBoundingClientRect();
    let r;
    el.addEventListener('pointermove', (e)=>{
      r = bounds();
      const x = (e.clientX - r.left)/r.width;
      const y = (e.clientY - r.top)/r.height;
      const rx = (y - .5) * -8;
      const ry = (x - .5) * 8;
      el.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(0)`;
    });
    el.addEventListener('pointerleave', ()=>{ el.style.transform='perspective(900px) rotateX(0) rotateY(0)'; });
  });
})();

/* ===== Confetti on form submit (lightweight canvas) ===== */
(function(){
  const cvs = document.getElementById('confetti'), ctx = cvs.getContext('2d');
  function size(){ cvs.width = innerWidth; cvs.height = innerHeight }
  size(); addEventListener('resize', size);
  function burst(){
    const N = 160, parts=[];
    for(let i=0;i<N;i++){
      parts.push({
        x: cvs.width/2, y: cvs.height/2 - 40,
        vx: (Math.random()*2-1)*6,
        vy: (Math.random()*-8)-2,
        g: 0.18 + Math.random()*0.08,
        a: 1,
        r: 2 + Math.random()*4,
        s: Math.random()<.5 ? 1 : -1,
        hue: Math.floor(200 + Math.random()*140)
      });
    }
    let t=0, raf;
    (function tick(){
      ctx.clearRect(0,0,cvs.width,cvs.height);
      parts.forEach(p=>{
        p.vy += p.g; p.x += p.vx; p.y += p.vy; p.a -= .006; p.r += p.s*.02;
        ctx.globalAlpha = Math.max(0,p.a);
        ctx.fillStyle = `hsl(${p.hue},90%,60%)`;
        ctx.beginPath(); ctx.arc(p.x,p.y,Math.abs(p.r),0,Math.PI*2); ctx.fill();
      });
      ctx.globalAlpha=1;
      t++;
      if(t<260) raf = requestAnimationFrame(tick);
      else ctx.clearRect(0,0,cvs.width,cvs.height);
    })();
    setTimeout(()=>{ if(raf) cancelAnimationFrame(raf); ctx.clearRect(0,0,cvs.width,cvs.height); }, 3200);
  }
  const form = document.getElementById('regForm');
  form.addEventListener('submit', ()=> burst(), {once:false});
})();

</script>
</body>
</html>
